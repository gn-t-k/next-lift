# フェーズ2: Webアプリケーションの実装 - タスクツリー

MBUD設計仕様（ユースケース定義、フレーム構造、コンテンツ構造）に基づき、Webアプリケーションの機能を実装する。

## 0. 基盤整備

- [ ] Per-User DBスキーマ設計
  - [ ] 全テーブルのER設計
    - [ ] exercise（種目）テーブル
    - [ ] training_record（トレーニング記録）テーブル
    - [ ] session（セッション）テーブル
    - [ ] set（セット）テーブル
    - [ ] training_plan（トレーニング計画）テーブル
    - [ ] scheduled_day（予定日）テーブル
    - [ ] planned_session（計画セッション）テーブル
    - [ ] planned_set（計画セット）テーブル
  - [ ] テーブル間のリレーション定義
  - [ ] ADR記録（スキーマ設計の意思決定）
- [ ] アプリケーションシェル
  - [ ] タブバー（記録 | 計画）の実装
  - [ ] 右上プロフィールアイコンの実装
  - [ ] 認証ガードの共通化（未認証時のリダイレクト）
  - [ ] ルーティング構造の設計と実装
- [ ] 共通UIコンポーネント拡充
  - [ ] フォーム系コンポーネント（テキスト入力、数値入力、日付選択、セレクト）
  - [ ] リスト・カード系コンポーネント（リストアイテム、カード）
  - [ ] フィードバック系コンポーネント（トースト、ローディング、空状態）
  - [ ] モーダル・ダイアログ系コンポーネント

## 1. 認証機能（UC_0014, UC_0015）

- [ ] サインインページ本格実装
  - [ ] サインインページのデザイン実装
  - [ ] Google OAuthサインインボタン
  - [ ] Apple OAuthサインインボタン
  - [ ] エラー表示（認証失敗、ネットワークエラー等）
  - [ ] ローディング状態の表示
- [ ] 初回サインイン時フロー確認
  - [ ] ユーザー作成 → Per-User DB作成 → ダッシュボードへのリダイレクト
  - [ ] Per-User DB作成失敗時のエラーハンドリング
- [ ] サインアウト（UC_0015）
  - [ ] V12プロフィールからのサインアウト機能
  - [ ] サインアウト後のリダイレクト

## 2. 種目管理（UC_0010, UC_0011, UC_0012, UC_0013）

- [ ] データ層
  - [ ] exerciseスキーマのDrizzle実装
  - [ ] マイグレーションファイルの生成と適用
  - [ ] Server Actions: 種目作成（UC_0010）
  - [ ] Server Actions: 種目一覧取得・検索（UC_0011）
  - [ ] Server Actions: 種目更新（UC_0012）
  - [ ] Server Actions: 種目削除（UC_0013）
  - [ ] 統合テスト
- [ ] UI
  - [ ] V13: 種目管理ページ
    - [ ] 種目リスト表示
    - [ ] 検索バー
    - [ ] 種目追加フォーム
    - [ ] 種目編集フォーム
    - [ ] 種目削除（確認ダイアログ付き）
  - [ ] V15: 種目選択モーダル
    - [ ] 検索バー
    - [ ] 種目リスト
    - [ ] 最近使った種目の上位表示
- [ ] プリセット種目データ
  - [ ] プリセット種目の定義（基本的なトレーニング種目）
  - [ ] 初回DB作成時のプリセット種目投入処理

## 3. トレーニング記録（UC_0001, UC_0002, UC_0003, UC_0004, UC_0019）

- [ ] データ層
  - [ ] training_record / session / setスキーマのDrizzle実装
  - [ ] マイグレーションファイルの生成と適用
  - [ ] Server Actions: 記録作成（UC_0001）
  - [ ] Server Actions: 記録一覧取得・記録詳細取得（UC_0002）
  - [ ] Server Actions: 記録更新（UC_0003）
  - [ ] Server Actions: 記録削除（UC_0004）
  - [ ] Server Actions: 種目の前回実施内容取得（UC_0019）
  - [ ] 統合テスト
- [ ] UI
  - [ ] V1: 記録一覧ページ
    - [ ] 週間トラッカー
    - [ ] リストビュー / カレンダービューの切替
    - [ ] ＋ボタン（新規記録作成へ）
    - [ ] 計画から作成ボタン（計画選択モーダルへ）
  - [ ] V2: 記録詳細ページ
    - [ ] ヘッダー（日付・メモ）
    - [ ] セッションカードのリスト表示
    - [ ] 種目名タップで種目統計モーダルへ
    - [ ] 編集ボタン
  - [ ] V4: 記録作成ページ
    - [ ] 日付入力
    - [ ] 種目追加ボタン（種目選択モーダル連携）
    - [ ] セット入力フォーム（重量・回数）
    - [ ] 前回実施内容の表示（UC_0019）
    - [ ] 計画データによる初期値設定（V16/V8からの遷移時）
    - [ ] 保存処理
  - [ ] V5: 記録編集ページ
    - [ ] V4と同様のフォーム（既存データで初期化）
    - [ ] 削除機能（確認ダイアログ付き）
    - [ ] 保存 / キャンセル

## 4. トレーニング計画（UC_0005, UC_0006, UC_0007, UC_0008, UC_0009）

- [ ] データ層
  - [ ] training_plan / scheduled_day / planned_session / planned_setスキーマのDrizzle実装
  - [ ] マイグレーションファイルの生成と適用
  - [ ] Server Actions: 計画作成（UC_0005）
  - [ ] Server Actions: 計画一覧取得・計画詳細取得（UC_0006）
  - [ ] Server Actions: 計画更新（UC_0007）
  - [ ] Server Actions: 計画削除（UC_0008）
  - [ ] 統合テスト
- [ ] UI
  - [ ] V7: 計画一覧ページ
    - [ ] カード形式のリスト
    - [ ] アクティブな計画の強調表示
    - [ ] ＋ボタン（新規計画作成へ）
  - [ ] V8: 計画詳細ページ
    - [ ] ヘッダー（計画名）
    - [ ] 予定日のリスト表示
    - [ ] 進捗状況の可視化
    - [ ] 実行ボタン（記録作成V4へ、計画データで初期化）
    - [ ] 編集ボタン
    - [ ] この計画に基づく記録一覧へのリンク
  - [ ] V9: 計画作成ページ
    - [ ] 計画名入力
    - [ ] 予定日追加フォーム
    - [ ] 種目選択（種目選択モーダル連携）
    - [ ] セット入力フォーム（重量・回数）
    - [ ] 種目統計参照ボタン（種目統計モーダルへ）
    - [ ] 保存処理
  - [ ] V10: 計画編集ページ
    - [ ] V9と同様のフォーム（既存データで初期化）
    - [ ] 削除機能（確認ダイアログ付き）
    - [ ] 保存 / キャンセル
  - [ ] V16: 計画選択モーダル
    - [ ] 検索バー
    - [ ] 計画リスト
    - [ ] アクティブな計画の上位表示
- [ ] UC_0009: 計画→記録入力連携
  - [ ] 計画詳細（V8）から記録作成（V4）への遷移フロー
  - [ ] 計画選択モーダル（V16）から記録作成（V4）への遷移フロー
  - [ ] 計画データによる記録フォーム初期値設定

## 5. 統計・分析（UC_0016, UC_0017）

- [ ] 計算ロジック
  - [ ] 1RM推定計算（Epley式等）
  - [ ] ボリューム集計（種目別・期間別）
  - [ ] PR（Personal Record）条件算出
  - [ ] 計算ロジックのユニットテスト
- [ ] データ取得
  - [ ] Server Actions: 種目の1RMとその割合の取得（UC_0016）
  - [ ] Server Actions: 現在の重量でのPR達成条件の取得（UC_0017）
  - [ ] Server Actions: 種目の成長推移データの取得
  - [ ] 統合テスト
- [ ] UI
  - [ ] V3: 種目統計モーダル
    - [ ] グラフエリア（1RM推移、ボリューム推移）
    - [ ] 統計サマリー（現在の推定1RM、最大ボリューム等）
    - [ ] セッション履歴リスト
    - [ ] この種目を含む計画一覧へのリンク
  - [ ] 1RM支援表示（計画作成/編集時の重量設定支援）
  - [ ] PR目標表示（記録作成時のプログレッシブオーバーロード確認）

## 6. プロフィール・データ管理（UC_0020）

- [ ] V12: プロフィールページ
  - [ ] アカウント情報表示
  - [ ] 種目管理へのリンク
  - [ ] データ管理へのリンク
  - [ ] サインアウト機能
- [ ] V14: データ管理ページ
  - [ ] トレーニングデータのエクスポート機能（UC_0020）
  - [ ] エクスポート形式の選定（CSV/JSON等）
  - [ ] AI分析用データ出力
