# CLAUDE.md

このファイルは、このリポジトリで作業する際にClaude Code (claude.ai/code) に対して提供するガイダンスです。

## 言語設定

- ユーザーへの応答は日本語で行う

## 関連ドキュメント

- @docs/project/overview.md : プロジェクト概要、機能、開発状況
- @docs/architecture-decision-record/overview.md : システムアーキテクチャと設計原則
- @docs/model-based-ui-design/ : UI設計仕様（ユースケース、タスク分析、コンセプト定義）

## 開発ルール

以下のルールファイルを参照:

- @.claude/rules/coding-style.md : コーディング規約
- @.claude/rules/error-handling.md : エラー修正手順
- @.claude/rules/testing.md : テスト開発ルール

作業内容が自明でない場合は `/dev-workflow` スキルを使用。
コードレビュー・CI分析などで問題を発見した場合は `/issue` スキルでGitHub Issueとして記録する。

## プロジェクト構造

```text
apps/
  web/   # Webアプリケーション
  ios/   # iOSアプリケーション

packages/
  env/                 # 環境変数の定義と取得
  utilities/           # 汎用ユーティリティ関数
  turso/               # Turso Platform APIとの通信
  authentication/      # 認証とPer-User DBトークン管理
  per-user-database/   # Per-User DBの作成とアクセス
  react-components/    # 共通UIコンポーネント
  tailwind-config/     # 共通スタイル定義
```

## 検証コマンド

- `pnpm type-check` : 型チェック
- `pnpm lint` : Biomeによるリント
- `pnpm test` : テスト実行
- `pnpm build` : ビルド確認

## 開発の基本方針

### 実装の計画と進め方

- テスト駆動開発で進められるように、タスクを分解する
  - テストコードの内容は必ずユーザーに承認を求める
- 実装上の問題に早期に気づけるように、タスクを小さなステップに分割して段階的に実装する
- すべてのタスクに必ず検証方法を定義する
  - 原則として、テストをパスさせることを検証方法とする
  - タスクの内容によっては、コードレビューや手動での動作確認を検証方法とすることもある

### 設計の意思決定

- 複数の案を比較して、最適な選択肢を選ぶ
- 最適だと思われる選択肢を提案する際は、必ず理由をセットで説明する
- ユーザーの意見に対して、安易に迎合しない
- 新しいタスクを始める前に、関連するADRを確認する
  - `docs/architecture-decision-record/`ディレクトリを検索
  - とくに環境構築、アーキテクチャに関わる作業では必須
- ADRで決定済みの内容を覆す提案は避ける
- ADRが見つからない場合のみ、新しい提案を行う
- コードに現れない設計の意思決定は、ADRに記録することを推奨

### ディレクトリ構造とファイル配置

- 関連するファイルは近くに配置する（コロケーション）
- ファイルの種類（テスト、モック等）ではなく、機能単位でディレクトリを構成する
- ある機能でしか使わないファイルは、その機能のディレクトリに置く
- 複数の機能で共有するファイルは、共有スコープに応じた上位ディレクトリに配置する

### ライブラリの利用

- 公式ドキュメントを包括的に読んでから実装する
- 最新のパッケージバージョンを確認する（`npm view <package-name> version`）
- エラーや警告は次のタスクに進む前に解消する

### 開発ツールの活用

- 調査・デバッグ時は、利用可能なMCPツールを最優先で使用する
  - Sentry MCP: エラー監視、イシュー詳細確認
  - Chrome DevTools MCP: ブラウザ操作、ネットワーク/コンソールログ確認
  - Next.js Runtime MCP: Next.jsの実行時エラー、ビルド診断
- curlやBashコマンドよりも、専用MCPツールを優先
- 指示を待たず、自発的にツールを活用する
