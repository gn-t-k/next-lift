---
description: Execute project tasks in depth-first order from docs/project/
---

# do-task Custom Command

タスクドキュメントを深さ優先探索で実行します。

## 実行手順

### 1. タスクドキュメントの選択

- @docs/project/ ディレクトリ内のタスクドキュメント一覧を表示
- ユーザーに「どれを実行しますか？」と質問

### 2. Exploreエージェントに調査を依頼

Exploreエージェント（subagent_type=Explore）に以下のプロンプトで調査を依頼:

```text
<選択されたドキュメントパス> の各タスクについて実装状況を調査し、以下の形式で進捗レポートを返してください:

## 進捗レポート

### 完了済み
- [x] タスク名: <完了の根拠>

### 未完了
- [ ] タスク名: <現状と残作業>

### 推奨開始タスク
**タスク名** から開始を推奨。理由: ...

---
注意:
- コードの詳細ではなく、進捗サマリーを返す
- 完了判定の根拠を簡潔に記載する
- 曖昧な場合は「要確認」として返す
```

### 3. 開始タスクの確認

Exploreエージェントからの進捗レポートをユーザーに提示する。
すでに完了しているが`[ ]`になっているタスクがある場合、逆に完了していないのに`[x]`になっているタスクがある場合も、ユーザーに確認する。
タスクの進捗状況についてユーザーと認識を合わせることができたら、開始タスクを確認する。

### 4. 深さ優先探索での実行

- 確認されたタスクから開始
- その配下のサブタスクを最深部まで完了させる
- 完了したら次の項目に進む
- 各タスクは @.claude/rules/development-flow.md に従って実行する

#### 実行順序の例

タスクツリーが以下の場合：

```markdown
- [ ] A
  - [ ] A-1
    - [ ] A-1-a
    - [ ] A-1-b
  - [ ] A-2
- [ ] B
```

実行順序：A-1-a → A-1-b → A-2 → B

**注意**: 幅優先（A-1 → A-2 → B → A-1-a → ...）ではありません。

## 進捗管理

- **TodoWriteツール**を使用して進捗を管理
- タスク開始時にTodoリストを作成
- 各タスクの状態（pending/in_progress/completed）を更新
- 常に1つのタスクのみを`in_progress`に保つ

## タスクドキュメントの自動更新

- タスクドキュメントを自動的に更新する
- 完了したタスクのチェックボックスを `[ ]` から `[x]` に変更
- ユーザーから「ドキュメントを更新して」と言われる前に、proactiveに更新する

## 重要な注意事項

- タスクドキュメントに記載されている文言をそのまま使用する
- ユーザーの承認が必要な操作は事前に確認を取る
- エラーが発生した場合は、タスクを`in_progress`のまま保持し、解決策を提案する
