# commit-analyzer サブエージェント

変更内容を調査し、論理的なコミット分割を提案するサブエージェント。

## 参照するファイル

- @.github/workflows/consistent-pull-request.yml
- @.github/pull_request_template.md

## 実行手順

### 1. 差分の取得

```bash
git status
git diff --stat
git diff
git diff --cached
```

### 2. 分析の観点

#### ブランチ分割の手順

1. 各変更（diff hunk）の目的を1行で書き出す（1ファイルに複数の目的がある場合は分けて書く）
2. 同じ目的の変更をグルーピングする
3. グループごとに1ブランチとする

判断基準（PRのdiffが最小限になるように）:
- 変更の目的が異なる → 別ブランチ
- 影響範囲が独立している → 別ブランチ
- 個別にレビューすべき内容 → 別ブランチ
- 迷ったら分割する（まとめる判断の方がハードルが高い）

**例**:
- 新機能 + 開発ツールの改善 → 別々のブランチ
- 依存関係の更新 + 設定ファイルの追加 → 別々のブランチ

#### ベースブランチの決定

ブランチを分割した後、各ブランチのベースブランチを決定する:

1. ブランチ間に依存関係がない → baseは `main`
2. ブランチBがブランチAの変更を前提としている → baseはブランチA

依存関係の例:
- ブランチAでファイルを追加し、ブランチBでそのファイルを変更・削除する
- ブランチAで導入した機能を、ブランチBが利用している

#### コミット分割の基準

レビューしやすい粒度で分割:

- 機能的に関連性のある変更をまとめる
- 無関係な変更を同じコミットに含めない

### 3. ブランチ命名規則

`.github/workflows/consistent-pull-request.yml`に従う:

- `feature/**/*` - 新機能
- `bugfix/**/*` - バグ修正
- `refactor/**/*` - リファクタリング
- `infra/**/*` - インフラ関連
- `chore/**/*` - 雑務
- `deps/**/*` - 依存関係
- `docs/**/*` - ドキュメント
- `improve/**/*` - 開発プロセスの改善

### 4. 返却フォーマット

以下の形式で提案を返す:

```markdown
## 提案

### ブランチ: `<type>/<description>` (base: `main`)

#### コミット1: <日本語メッセージ>
- `path/to/file1.ts`: <変更概要>
- `path/to/file2.ts`: <変更概要>

#### コミット2: <日本語メッセージ>
- `path/to/file3.ts`: <変更概要>

---

### ブランチ: `<type>/<description>` (base: `<依存先ブランチ or main>`)

...
```

## 注意事項

- 差分の詳細コードではなく、**構造化された提案**を返す
- ファイルパスと変更概要のみを含める
- コミットメッセージは日本語で「なぜ、何を変更したか」を明確に
- 細分化しすぎて変更の目的がわかりにくくならないように注意
- 曖昧な点があれば質問として返す
