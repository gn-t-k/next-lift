---
name: dev-workflow
description: フェーズ分けされた開発ワークフロー。要件定義→設計→実装計画→実装→レビューの5フェーズで、各フェーズでユーザー承認を得ながら進める。新機能追加、機能修正、リファクタリングなど、複数ステップが必要な開発タスクで使用する。明示的に /dev-workflow で呼び出すか、「〜を実装したい」「〜機能を追加したい」などの開発依頼で自動トリガー。
---

# Dev Workflow

フェーズ分けされた開発ワークフロー。各フェーズでユーザー承認を得てから次へ進む。

## フェーズ概要

```
要件定義 → 設計 → 実装計画 → 実装（TDD） → レビュー
```

## 開始時

1. `docs/development/[yyyy-mm-dd-feature-name]/` ディレクトリを作成
2. 以降、各フェーズの成果物をこのディレクトリに保存

## フェーズ1: 要件定義

### 目的

ユーザーの要望を理解し、実装可能な要件として合意を得る。

### 手順

1. ユーザーの要望（実現したい状況）と要求（具体的な依頼）を整理
2. 実現可能性を調査（コードベース、Web検索）
3. 要件としてまとめ、ユーザーの合意を得る
4. `01-requirements.md` に保存

### テンプレート

`references/requirements-template.md` を使用。

### 完了条件

- [ ] 要件をユーザーが承認

## フェーズ2: 設計

### 目的

変更の方向性を決め、ユーザーと合意する。詳細設計はTDDで創発的に決定する。

### 手順

1. 影響範囲を特定（apps/, packages/, DB, 外部API）
2. アプローチを決定（既存拡張 or 新規追加）
3. 技術的意思決定が必要なら ADR を作成
4. `02-design.md` に保存

### テンプレート

`references/design-template.md` を使用。

### 完了条件

- [ ] 設計をユーザーが承認

## フェーズ3: 実装計画

### 目的

実装をタスクに分割し、各タスクの検証方法を決める。

### 手順

Planエージェント（subagent_type=Plan）を使用して計画を立案。

計画に含める内容：

- 必要なモジュール/変更箇所の特定
- スモールステップへの分解
- 各ステップの検証方法（フィードバックループ）
- 依存関係と実装順序

### 検証方法の選択基準（優先順位順）

#### 優先度1: 型チェック

型システムで検証可能な場合は型チェックのみで進める。

例：
- 関数のシグネチャ変更
- 新しい型の追加
- インターフェースの定義

#### 優先度2: テスト

型だけでは検証できない振る舞いがある場合はテストを書く。

例：
- ビジネスロジックの正確性
- エッジケースの処理
- 複数の関数の連携

#### 優先度3: 手動確認

テストでも検証が難しい場合は手動で確認する。

例：
- UIの見た目・レイアウト
- ブラウザ固有の動作
- 外部サービスとの連携

手動確認が必要な場合：
- Chrome DevTools MCPでブラウザを操作
- またはユーザーに確認を依頼

### テンプレート

`references/implementation-plan-template.md` を使用。

### 成果物

`03-implementation-plan.md` に保存。

### 完了条件

- [ ] 実装計画をユーザーが承認

## フェーズ4: 実装

### 目的

TDDサイクルでタスクを実装する。

### 手順

各タスクについて：

1. テスト・型定義を先に書く
2. ユーザーにレビューさせ、合意を得る
3. テストが通る最小限の実装を書く
4. リファクタリング（テストが通る状態を維持）
5. 検証方法に従って確認

### 完了条件

- [ ] 全タスク完了
- [ ] `pnpm type-check && pnpm lint && pnpm test` が通る

## フェーズ5: レビュー

### 目的

実装完了後、品質を確認する。

### 手順

Exploreエージェント（subagent_type=Explore）でレビューを行う。

### 確認観点

- 既存の仕様との整合性
- 既存の実装との一貫性
- テストの網羅性（カバレッジ80%目安）
- 一般的なコードレビュー（保守性・パフォーマンス・セキュリティなど）

### 完了条件

- [ ] レビュー指摘事項を解消
