# 開発フロー

機能実装・修正時に適用するプロセス。

## 1. タスク開始前

### タスクの複雑さ判断

#### Planモード推奨（複雑）

- 複数ファイルにまたがる変更
- 新規モジュールの追加
- 設計判断が必要な場合
- 依存関係の変更

#### 直接実行可能（単純）

- 単一ファイルの修正
- バグ修正（原因特定済み）
- 設定変更
- ドキュメント更新

## 2. 計画フェーズ

### 基本フロー

1. 実現したい機能や修正内容についてユーザーと合意を取る。
2. 機能を実現するために必要なモジュールを検討し、ユーザーと合意を取る。
3. Planエージェントを使って実装計画を立案する。

### Planエージェントによる計画立案

複雑なタスクの場合、Planエージェント（subagent_type=Plan）を使って計画を立案する。

呼び出し時は「@.claude/rules/development-flow.md を参照して計画を立案してください」と指示する。

計画に含める内容:

- 必要なモジュール/変更箇所の特定
- スモールステップへの分解
- 各ステップの検証方法（フィードバックループ）
- 依存関係と実装順序

#### フィードバックループの設計指針

各ステップの検証方法を、以下の優先順位で選択する:

##### 優先度1: 型定義によるチェック

型システムで検証可能な場合は型チェックのみで進める。

例:

- 関数のシグネチャ変更
- 新しい型の追加
- インターフェースの定義

##### 優先度2: テストによるチェック

型だけでは検証できない振る舞いがある場合はテストを書く。

例:

- ビジネスロジックの正確性
- エッジケースの処理
- 複数の関数の連携

##### 優先度3: 手動確認

テストでも検証が難しい場合は手動で確認する。

例:

- UIの見た目・レイアウト
- ブラウザ固有の動作
- 外部サービスとの連携

手動確認が必要な場合:

- Chrome DevTools MCPでブラウザを操作
- またはユーザーに確認を依頼

## 3. 実装フェーズ

### モジュール実装プロセス

モジュールの実装前にインターフェースや依存の設計を先に確定するため、モジュールを追加・変更する際は以下のプロセスで進める:

1. まず型定義とテストを書く
2. 型定義とテストの内容をユーザーにレビューさせ、同意を得る
3. 型チェックとテストを通すための最小限の実装を書く
4. 型チェックとテストが通る状態を保ちながらリファクタリング

## 4. レビューフェーズ

### Exploreエージェントによるレビュー

実装完了後、Exploreエージェント（subagent_type=Explore）でレビューを行う。

確認観点:

- @.claude/rules/coding-style.md への準拠
- 他の実装との一貫性
- 重複コードの有無（妥当な重複はOK）
- テストの網羅性（カバレッジ80%目安）
- 型安全性
